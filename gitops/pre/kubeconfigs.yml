apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name:  amer-west-project-kubeconfig
  namespace: ucp-token-generator
spec:
  refreshInterval: 1m
  secretStoreRef:
    kind: ClusterSecretStore
    name: k8s-store
  target:
    name: amer-west-project-kubeconfig
    template:
      engineVersion: v2
      data:
        value.yaml: |
          apiVersion: v1
          clusters:
          - cluster:
              server: https://api.tanzu.cloud.vmware.com/org/77aee83b-308f-4c8e-b9c4-3f7a6f19ba75/project/3b65ba5e-52a4-4666-ad29-4eefab93127b
            name: sa-tanzu-platform:AMER-West
          contexts:
          - context:
              cluster: sa-tanzu-platform:AMER-West
              user: sa-tanzu-platform-user
            name: sa-tanzu-platform:AMER-West
          current-context: sa-tanzu-platform:AMER-West
          kind: Config
          preferences: {}
          users:
          - name: sa-tanzu-platform-user
            user:
              token: "{{ .token }}"
  data:
  - secretKey: token
    remoteRef:
      key: ucp-access-token
      property: access_token
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name:  warroyo-run-eks-kubeconfig
  namespace: ucp-token-generator
spec:
  refreshInterval: 1m
  secretStoreRef:
    kind: ClusterSecretStore
    name: k8s-store
  target:
    name: warroyo-run-eks-kubeconfig
    template:
      engineVersion: v2
      data:
        value.yaml: |
          apiVersion: v1
          clusters:
          - cluster:
              server: https://api.tanzu.cloud.vmware.com/org/77aee83b-308f-4c8e-b9c4-3f7a6f19ba75/project/3b65ba5e-52a4-4666-ad29-4eefab93127b/clustergroup/warroyo-run-eks
            name: sa-tanzu-platform:AMER-West:warroyo-run-eks
          contexts:
          - context:
              cluster: sa-tanzu-platform:AMER-West:warroyo-run-eks
              user: sa-tanzu-platform-user
            name: sa-tanzu-platform:AMER-West:warroyo-run-eks
          current-context: sa-tanzu-platform:AMER-West:warroyo-run-eks
          kind: Config
          preferences: {}
          users:
          - name: sa-tanzu-platform-user
            user:
              token: "{{ .token }}"
  data:
  - secretKey: token
    remoteRef:
      key: ucp-access-token
      property: access_token

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name:  flux-dev-kubeconfig
  namespace: ucp-token-generator
spec:
  refreshInterval: 1m
  secretStoreRef:
    kind: ClusterSecretStore
    name: k8s-store
  target:
    name: flux-dev-kubeconfig
    template:
      engineVersion: v2
      data:
        value.yaml: |
          apiVersion: v1
          clusters:
          - cluster:
              server: https://api.tanzu.cloud.vmware.com/org/77aee83b-308f-4c8e-b9c4-3f7a6f19ba75/project/3b65ba5e-52a4-4666-ad29-4eefab93127b/space/flux-dev
            name: sa-tanzu-platform:AMER-West:flux-dev
          contexts:
          - context:
              cluster: sa-tanzu-platform:AMER-West:flux-dev
              user: sa-tanzu-platform-user
            name: sa-tanzu-platform:AMER-West:flux-dev
          current-context: sa-tanzu-platform:AMER-West:flux-dev
          kind: Config
          preferences: {}
          users:
          - name: sa-tanzu-platform-user
            user:
              token: "{{ .token }}"
  data:
  - secretKey: token
    remoteRef:
      key: ucp-access-token
      property: access_token

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name:  flux-int-kubeconfig
  namespace: ucp-token-generator
spec:
  refreshInterval: 1m
  secretStoreRef:
    kind: ClusterSecretStore
    name: k8s-store
  target:
    name: flux-int-kubeconfig
    template:
      engineVersion: v2
      data:
        value.yaml: |
          apiVersion: v1
          clusters:
          - cluster:
              server: https://api.tanzu.cloud.vmware.com/org/77aee83b-308f-4c8e-b9c4-3f7a6f19ba75/project/3b65ba5e-52a4-4666-ad29-4eefab93127b/space/flux-int
            name: sa-tanzu-platform:AMER-West:flux-int
          contexts:
          - context:
              cluster: sa-tanzu-platform:AMER-West:flux-int
              user: sa-tanzu-platform-user
            name: sa-tanzu-platform:AMER-West:flux-int
          current-context: sa-tanzu-platform:AMER-West:flux-int
          kind: Config
          preferences: {}
          users:
          - name: sa-tanzu-platform-user
            user:
              token: "{{ .token }}"
  data:
  - secretKey: token
    remoteRef:
      key: ucp-access-token
      property: access_token